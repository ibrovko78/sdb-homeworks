# Домашнее задание к занятию «Репликация и масштабирование. Часть 1» - Бровко Иван Геннадьевич

---

### Задание 1

На лекции рассматривались режимы репликации master-slave, master-master, опишите их различия.

* В режиме master-slave все изменения возможны только на мастере, данные на слейве по поределению доступны только для чтения чтения, также из-за особенности архитектуры слейв потребляет гораздо больше ресурсов чем мастер. В режиме master-master каждый сервер является и мастером и слейвом.

---

### Задание 2

Выполните конфигурацию master-slave репликации, примером можно пользоваться из лекции.
* Настройка master-slave
```
docker run -d --name replication-master -e MYSQL_ALLOW_EMPTY_PASSWORD=true -v ~/path/to/world/dump:/docker-entrypoint-initdb.d  mysql:8.0
docker run -d --name replication-slave -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql:8.0
docker network create replication
docker network connect replication replication-master
docker network connect replication replication-slave

docker exec replication-master microdnf makecache && docker exec replication-master microdnf install -y nano
docker exec replication-slave microdnf makecache && docker exec replication-slave microdnf install -y nano

### MASTER
создадим учетную запись на мастере, которая будет использоваться для репликации:
docker exec -it replication-master mysql

mysql> CREATE USER 'replication'@'%';
mysql> GRANT REPLICATION SLAVE ON *.* TO 'replication'@'%';

изменим конфигурационные файлы для мастер-сервера
docker exec -it replication-master sh -c "nano /etc/mysql/my.cnf"

перезагружаем контейнер
docker restart replication-master

заходим в контейнер и проверяем что двоичный журнал включен
docker exec -it replication-master mysql
mysql> SHOW MASTER STATUS;

Для того, чтобы начать репликацию данных, необходимо “подтянуть” слейв до состояния мастера.
Для этого, нужно временно заблокировать сам мастер, чтобы сделать слепок актуальных данных.
mysql> FLUSH TABLES WITH READ LOCK;

с помощью mysqldump сделаем экспорт данных из базы
docker exec -it replication-master mysqldump world > /root/world.sql

снимаем блокировку
docker exec -it replication-master mysql
mysql> UNLOCK TABLES;

```



---

## Дополнительные задания (со звёздочкой*)
Эти задания дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.

---

### Задание 3* 

Выполните конфигурацию master-master репликации. Произведите проверку.

*Приложите скриншоты конфигурации, выполнения работы: состояния и режимы работы серверов.*
